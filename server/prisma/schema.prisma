// VideoText production user store. Run: npx prisma generate, npx prisma migrate deploy
generator client {
  provider = "prisma-client-js"
}

// Connection URL is set in prisma.config.ts (Prisma 7+)
datasource db {
  provider = "postgresql"
}

model User {
  id                       String   @id
  email                    String
  passwordHash             String   @default("")
  plan                     String   // free | basic | pro | agency
  stripeCustomerId         String?  @unique
  subscriptionId           String?
  paymentMethodId          String?
  billingPeriodStart       DateTime?
  billingPeriodEnd         DateTime?
  passwordSetupToken       String?
  passwordSetupExpiresAt   DateTime?
  passwordSetupUsed        Boolean  @default(false)
  passwordResetToken       String?
  passwordResetExpiresAt   DateTime?
  usageThisMonth           Json     // { totalMinutes, videoCount, ... resetDate (ISO string) }
  limits                   Json     // PlanLimits
  overagesThisMonth        Json     // { minutes, languages, batches, totalCharge }
  createdAt                DateTime
  updatedAt                DateTime
}

// Batch job state shared by API and worker (persisted so separate containers see same state).
model BatchJobRecord {
  id               String    @id
  userId           String
  totalVideos      Int
  totalDuration    Int       // seconds
  processedVideos  Int       @default(0)
  failedVideos     Int       @default(0)
  status           String    // queued | processing | completed | failed | partial
  zipPath          String?
  zipSize          Int?
  errors           Json      @default("[]") // [{ videoName, reason }]
  createdAt        DateTime
  completedAt      DateTime?
  expiresAt        DateTime
}
